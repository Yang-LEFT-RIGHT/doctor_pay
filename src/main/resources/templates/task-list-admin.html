<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>任务管理 - DocIM Stipend</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/admin-tasks.css">
    <link rel="stylesheet" href="css/notification.css">
</head>
<body>
    <div class="top-bar">
        <a href="admin-dashboard.html" class="logo">
            <i class="fas fa-graduation-cap"></i>
            <span>DocIM</span> Stipend
        </a>
        
        <div class="main-nav">
            <a href="admin-dashboard.html" class="nav-item">
                <i class="fas fa-tachometer-alt"></i> 工作台首页
            </a>
            <a href="admin-management.html" class="nav-item">
                <i class="fas fa-user-shield"></i> 管理员管理
            </a>
        </div>
        
        <div class="top-tools">
            <div class="user-info">
                <span class="role-badge">管理员</span>
                <span id="username">李老师</span>
            </div>
            
            <button class="notification-btn" id="notificationBtn">
                <i class="fas fa-bell"></i>
                <span class="notification-badge" id="notificationCount">5</span>
            </button>
            
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                退出
            </button>
        </div>
    </div>

    <!-- 通知弹窗 -->
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <h3><i class="fas fa-bell"></i> 通知中心</h3>
            <div class="notification-actions">
                <button class="btn-mark-all-read" id="markAllReadBtn">
                    <i class="fas fa-check-double"></i> 全部已读
                </button>
                <button class="btn-clear-all" id="clearAllBtn">
                    <i class="fas fa-trash-alt"></i> 清空
                </button>
            </div>
        </div>
        
        <div class="notification-list" id="notificationList">
            <!-- 通知项将通过JavaScript动态生成 -->
        </div>
        
        <div class="notification-footer">
            <a href="notification-center.html" class="view-all-link">
                <i class="fas fa-external-link-alt"></i> 前往通知中心
            </a>
        </div>
    </div>
    
    <!-- 通知遮罩层 -->
    <div class="notification-overlay" id="notificationOverlay"></div>

    <div class="page-content">
        <div class="sidebar">
            <nav class="sidebar-nav">
                <a href="admin-dashboard.html" class="sidebar-item">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>工作台首页</span>
                </a>
                <a href="task-list-admin.html" class="sidebar-item active">
                    <i class="fas fa-list-ul"></i>
                    <span>任务管理</span>
                </a>
                <a href="student-list.html" class="sidebar-item">
                    <i class="fas fa-users"></i>
                    <span>博士生管理</span>
                </a>
                <a href="stats-overview.html" class="sidebar-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>统计分析</span>
                </a>
                <a href="system-settings.html" class="sidebar-item">
                    <i class="fas fa-cog"></i>
                    <span>系统设置</span>
                </a>
                <a href="notification-center.html" class="sidebar-item">
                    <i class="fas fa-bell"></i>
                    <span>通知中心</span>
                    <span class="sidebar-badge" id="sidebarNotificationCount">5</span>
                </a>
            </nav>
        </div>

        <div class="content-area">
            <!-- 页面标题区域 -->
            <div class="page-header">
                <div class="page-title-section">
                    <h1 class="page-title">任务管理</h1>
                    <p class="page-subtitle">查看和管理所有发布的代管/助教任务，支持高级筛选和批量操作</p>
                </div>
                
                <div class="header-actions">
                    <button class="btn-secondary" onclick="toggleAdvancedFilters()">
                        <i class="fas fa-filter"></i>
                        高级筛选
                    </button>
                    <button class="btn-secondary" onclick="exportData()">
                        <i class="fas fa-file-export"></i>
                        导出数据
                    </button>
                    <button class="btn-primary" onclick="newTask()">
                        <i class="fas fa-plus"></i>
                        发布新任务
                    </button>
                </div>
            </div>
            
            <!-- 搜索栏 -->
            <div class="search-section">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="taskSearch" placeholder="搜索任务名称、博士生姓名...">
                    <button class="search-clear" id="clearSearch">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <!-- 高级筛选区域 -->
            <div class="advanced-filters" id="advancedFilters">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label class="filter-label">任务状态</label>
                        <select class="filter-select" id="statusFilter">
                            <option value="">全部状态</option>
                            <option value="pending">待确认</option>
                            <option value="confirmed">已确认</option>
                            <option value="rejected">已拒绝</option>
                            <option value="in-progress">进行中</option>
                            <option value="completed">已完成</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">任务类型</label>
                        <select class="filter-select" id="typeFilter">
                            <option value="">全部类型</option>
                            <option value="course">课程助教</option>
                            <option value="thesis">论文指导</option>
                            <option value="lab">实验室管理</option>
                            <option value="admin">行政协助</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">发布时间</label>
                        <select class="filter-select" id="timeFilter">
                            <option value="">全部时间</option>
                            <option value="week">最近一周</option>
                            <option value="month">最近一月</option>
                            <option value="quarter">最近一季度</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">截止时间</label>
                        <select class="filter-select" id="deadlineFilter">
                            <option value="">全部</option>
                            <option value="week">一周内到期</option>
                            <option value="today">今天到期</option>
                            <option value="expired">已过期</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-actions">
                    <button class="btn-outline" onclick="clearFilters()">
                        <i class="fas fa-times"></i>
                        清除筛选
                    </button>
                    <button class="btn-primary" onclick="applyFilters()">
                        <i class="fas fa-check"></i>
                        应用筛选
                    </button>
                </div>
            </div>
            
            <!-- 任务列表区域 -->
            <div class="tasks-section">
                <div class="section-header">
                    <div class="section-info">
                        <h3 class="section-title">任务列表</h3>
                        <div class="tasks-count">
                            共 <span id="totalTasks">28</span> 个任务，<span id="pendingTasks" class="highlight">7</span> 个待确认
                        </div>
                    </div>
                </div>
                
                <!-- 表格视图 -->
                <div class="tasks-table-view" id="tableView">
                    <div class="table-container">
                        <table class="tasks-table">
                            <thead>
                                <tr>
                                    <th class="task-title-col">任务名称</th>
                                    <th class="task-assignee-col">需求人数</th>
                                    <th class="task-status-col">状态</th>
                                    <th class="task-time-col">发布时间</th>
                                    <th class="task-deadline-col">截止时间</th>
                                    <th class="task-actions-col">操作</th>
                                </tr>
                            </thead>
                            <tbody id="tasksTableBody">
                                <tr>
                                    <td>
                                        <div class="task-title-cell">
                                            <div class="task-title">《计算机视觉》课程助教 - 实验课指导</div>
                                            <div class="task-type">课程助教</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="requirement-info">
                                            <span class="requirement-badge">2人</span>
                                            <div class="requirement-details">
                                                <div class="requirement-progress">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill progress-50-75" style="width: 50%"></div>
                                                    </div>
                                                    <span class="progress-text">1/2人</span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge status-pending">待确认</span>
                                    </td>
                                    <td>2023-11-15</td>
                                    <td>
                                        <div class="deadline-cell">
                                            <div>2023-11-30</div>
                                            <div class="deadline-warning">剩余5天</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn edit-btn" title="编辑" onclick="editTask(1)">
                                                <i class="far fa-edit"></i>
                                            </button>
                                            <button class="action-btn view-btn" title="查看详情" onclick="viewTask(1)">
                                                <i class="far fa-eye"></i>
                                            </button>
                                            <button class="action-btn delete-btn" title="删除" onclick="deleteTask(1)">
                                                <i class="far fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td>
                                        <div class="task-title-cell">
                                            <div class="task-title">实验室设备维护与管理</div>
                                            <div class="task-type">实验室管理</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="requirement-info">
                                            <span class="requirement-badge">1人</span>
                                            <div class="requirement-details">
                                                <div class="requirement-progress">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill progress-25-50" style="width: 100%"></div>
                                                    </div>
                                                    <span class="progress-text">1/1人</span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge status-confirmed">已确认</span>
                                    </td>
                                    <td>2023-10-20</td>
                                    <td>
                                        <div class="deadline-cell">
                                            <div>2023-12-31</div>
                                            <div class="deadline-normal">剩余46天</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn edit-btn" title="编辑" onclick="editTask(2)">
                                                <i class="far fa-edit"></i>
                                            </button>
                                            <button class="action-btn view-btn" title="查看详情" onclick="viewTask(2)">
                                                <i class="far fa-eye"></i>
                                            </button>
                                            <button class="action-btn delete-btn" title="删除" onclick="deleteTask(2)">
                                                <i class="far fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td>
                                        <div class="task-title-cell">
                                            <div class="task-title">本科生毕业论文指导 - 每周例会</div>
                                            <div class="task-type">论文指导</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="requirement-info">
                                            <span class="requirement-badge">3人</span>
                                            <div class="requirement-details">
                                                <div class="requirement-progress">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill progress-0-25" style="width: 0%"></div>
                                                    </div>
                                                    <span class="progress-text">0/3人</span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge status-pending">待确认</span>
                                    </td>
                                    <td>2023-11-10</td>
                                    <td>
                                        <div class="deadline-cell">
                                            <div>2023-12-05</div>
                                            <div class="deadline-warning">剩余10天</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn edit-btn" title="编辑" onclick="editTask(3)">
                                                <i class="far fa-edit"></i>
                                            </button>
                                            <button class="action-btn view-btn" title="查看详情" onclick="viewTask(3)">
                                                <i class="far fa-eye"></i>
                                            </button>
                                            <button class="action-btn delete-btn" title="删除" onclick="deleteTask(3)">
                                                <i class="far fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td>
                                        <div class="task-title-cell">
                                            <div class="task-title">本科生论文开题评审</div>
                                            <div class="task-type">论文评审</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="requirement-info">
                                            <span class="requirement-badge">2人</span>
                                            <div class="requirement-details">
                                                <div class="requirement-progress">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill progress-0-25" style="width: 0%"></div>
                                                    </div>
                                                    <span class="progress-text">0/2人</span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge status-rejected">已拒绝</span>
                                    </td>
                                    <td>2023-10-10</td>
                                    <td>
                                        <div class="deadline-cell">
                                            <div>2023-11-15</div>
                                            <div class="deadline-expired">已过期</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn edit-btn" title="编辑" onclick="editTask(4)">
                                                <i class="far fa-edit"></i>
                                            </button>
                                            <button class="action-btn view-btn" title="查看详情" onclick="viewTask(4)">
                                                <i class="far fa-eye"></i>
                                            </button>
                                            <button class="action-btn delete-btn" title="删除" onclick="deleteTask(4)">
                                                <i class="far fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td>
                                        <div class="task-title-cell">
                                            <div class="task-title">学院学术会议组织协助</div>
                                            <div class="task-type">行政协助</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="requirement-info">
                                            <span class="requirement-badge">4人</span>
                                            <div class="requirement-details">
                                                <div class="requirement-progress">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill progress-50-75" style="width: 25%"></div>
                                                    </div>
                                                    <span class="progress-text">1/4人</span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge status-confirmed">已确认</span>
                                    </td>
                                    <td>2023-11-05</td>
                                    <td>
                                        <div class="deadline-cell">
                                            <div>2023-12-10</div>
                                            <div class="deadline-normal">剩余15天</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn edit-btn" title="编辑" onclick="editTask(5)">
                                                <i class="far fa-edit"></i>
                                            </button>
                                            <button class="action-btn view-btn" title="查看详情" onclick="viewTask(5)">
                                                <i class="far fa-eye"></i>
                                            </button>
                                            <button class="action-btn delete-btn" title="删除" onclick="deleteTask(5)">
                                                <i class="far fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td>
                                        <div class="task-title-cell">
                                            <div class="task-title">《机器学习》课程作业批改</div>
                                            <div class="task-type">课程助教</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="requirement-info">
                                            <span class="requirement-badge">2人</span>
                                            <div class="requirement-details">
                                                <div class="requirement-progress">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill progress-75-100" style="width: 100%"></div>
                                                    </div>
                                                    <span class="progress-text">2/2人</span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge status-completed">已完成</span>
                                    </td>
                                    <td>2023-10-25</td>
                                    <td>
                                        <div class="deadline-cell">
                                            <div>2023-11-10</div>
                                            <div class="deadline-completed">已完成</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn edit-btn" title="编辑" onclick="editTask(6)">
                                                <i class="far fa-edit"></i>
                                            </button>
                                            <button class="action-btn view-btn" title="查看详情" onclick="viewTask(6)">
                                                <i class="far fa-eye"></i>
                                            </button>
                                            <button class="action-btn delete-btn" title="删除" onclick="deleteTask(6)">
                                                <i class="far fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- 分页控制 -->
                <div class="pagination-controls">
                    <div class="pagination-info">
                        显示 1-6 条，共 28 条记录
                    </div>
                    <div class="pagination-buttons">
                        <button class="pagination-btn" disabled>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="page-number active">1</button>
                        <button class="page-number">2</button>
                        <button class="page-number">3</button>
                        <span class="page-ellipsis">...</span>
                        <button class="page-number">5</button>
                        <button class="pagination-btn">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="rows-per-page">
                        每页显示
                        <select>
                            <option>10条</option>
                            <option selected>20条</option>
                            <option>50条</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- 博士生申请列表 -->
            <div class="tasks-section">
                <div class="section-header">
                    <div class="section-info">
                        <h3 class="section-title">博士生申请列表</h3>
                        <div class="tasks-count">
                            共 <span id="totalApplications">15</span> 个申请，<span id="pendingApplications" class="highlight">5</span> 个待审核
                        </div>
                    </div>
                </div>
                
                <!-- 表格视图 -->
                <div class="tasks-table-view" id="applicationsTableView">
                    <div class="table-container">
                        <table class="tasks-table">
                            <thead>
                                <tr>
                                    <th class="task-title-col">申请任务</th>
                                    <th class="task-assignee-col">申请人</th>
                                    <th class="task-status-col">申请状态</th>
                                    <th class="task-time-col">申请时间</th>
                                    <th class="task-deadline-col">提交材料</th>
                                    <th class="task-actions-col">操作</th>
                                </tr>
                            </thead>
                            <tbody id="applicationsTableBody">
                                <tr>
                                    <td>
                                        <div class="task-title-cell">
                                            <div class="task-title">《计算机视觉》课程助教 - 实验课指导</div>
                                            <div class="task-type">课程助教</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="assignee-info">
                                            <div class="assignee-avatar">张</div>
                                            <div class="assignee-name">张三博士</div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge status-pending">待审核</span>
                                    </td>
                                    <td>2023-11-20</td>
                                    <td>
                                        <div class="application-materials">
                                            <span class="material-badge">简历</span>
                                            <span class="material-badge">成绩单</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn view-btn" title="查看申请" onclick="viewApplication(1)">
                                                <i class="far fa-eye"></i>
                                            </button>
                                            <button class="action-btn approve-btn" title="通过" onclick="approveApplication(1)">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="action-btn reject-btn" title="拒绝" onclick="rejectApplication(1)">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td>
                                        <div class="task-title-cell">
                                            <div class="task-title">实验室设备维护与管理</div>
                                            <div class="task-type">实验室管理</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="assignee-info">
                                            <div class="assignee-avatar">李</div>
                                            <div class="assignee-name">李四博士</div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge status-confirmed">已通过</span>
                                    </td>
                                    <td>2023-10-25</td>
                                    <td>
                                        <div class="application-materials">
                                            <span class="material-badge">简历</span>
                                            <span class="material-badge">证书</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn view-btn" title="查看申请" onclick="viewApplication(2)">
                                                <i class="far fa-eye"></i>
                                            </button>
                                            <button class="action-btn undo-btn" title="撤销" onclick="undoApplication(2)">
                                                <i class="fas fa-undo"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td>
                                        <div class="task-title-cell">
                                            <div class="task-title">本科生毕业论文指导 - 每周例会</div>
                                            <div class="task-type">论文指导</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="assignee-info">
                                            <div class="assignee-avatar">王</div>
                                            <div class="assignee-name">王五博士</div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge status-pending">待审核</span>
                                    </td>
                                    <td>2023-11-18</td>
                                    <td>
                                        <div class="application-materials">
                                            <span class="material-badge">简历</span>
                                            <span class="material-badge">论文</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn view-btn" title="查看申请" onclick="viewApplication(3)">
                                                <i class="far fa-eye"></i>
                                            </button>
                                            <button class="action-btn approve-btn" title="通过" onclick="approveApplication(3)">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="action-btn reject-btn" title="拒绝" onclick="rejectApplication(3)">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- 分页控制 -->
                <div class="pagination-controls">
                    <div class="pagination-info">
                        显示 1-3 条，共 15 条记录
                    </div>
                    <div class="pagination-buttons">
                        <button class="pagination-btn" disabled>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="page-number active">1</button>
                        <button class="page-number">2</button>
                        <button class="page-number">3</button>
                        <button class="pagination-btn">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="rows-per-page">
                        每页显示
                        <select>
                            <option>10条</option>
                            <option selected>20条</option>
                            <option>50条</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 全局帮助中心/页脚 -->
    <div class="global-footer">
        <div class="footer-container">
            <div class="footer-title">
                <i class="fas fa-life-ring"></i> 帮助中心与支持
            </div>
            
            <div class="footer-grid">
                <a href="admin-guide.html" class="footer-card">
                    <h4><i class="fas fa-book"></i> 管理员指南</h4>
                    <p>了解系统管理操作流程，快速上手使用各项功能</p>
                </a>
                
                <a href="admin-manual.html" class="footer-card">
                    <h4><i class="fas fa-file-alt"></i> 管理员手册</h4>
                    <p>详细管理功能说明文档，包含所有操作步骤</p>
                </a>
                
                <a href="admin-faq.html" class="footer-card">
                    <h4><i class="fas fa-question-circle"></i> 常见问题</h4>
                    <p>快速查找和解决管理中的常见问题</p>
                </a>
                
                <a href="contact.html" class="footer-card">
                    <h4><i class="fas fa-comments"></i> 联系反馈</h4>
                    <p>获取技术支持，提交使用反馈、建议和问题报告</p>
                </a>
            </div>
        </div>
    </div>

    <!-- 初始化失败弹窗 -->
    <div class="error-modal" id="initErrorModal" style="display: none;">
        <div class="error-modal-content">
            <div class="error-modal-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="error-modal-text">
                <h3>页面初始化失败</h3>
                <p>抱歉，任务管理页面加载时出现问题。请刷新页面或稍后再试。</p>
            </div>
            <div class="error-modal-actions">
                <button class="btn-secondary" onclick="closeErrorModal()">关闭</button>
                <button class="btn-primary" onclick="refreshPage()">刷新页面</button>
            </div>
        </div>
    </div>

    <script src="js/theme.js"></script>
    <script src="js/admin-tasks.js"></script>
    <script src="js/notification.js"></script>
    <script>
        // 简单JavaScript交互
        function toggleAdvancedFilters() {
            const filters = document.getElementById('advancedFilters');
            filters.classList.toggle('active');
        }
        
        function switchView(view) {
            const tableBtns = document.querySelectorAll('.view-btn');
            tableBtns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        function exportData() {
            alert('导出功能开发中...');
        }
        
        function newTask() {
            window.location.href = 'new-task.html';
        }
        
        function clearFilters() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('typeFilter').value = '';
            document.getElementById('timeFilter').value = '';
            document.getElementById('deadlineFilter').value = '';
            document.getElementById('taskSearch').value = '';
            alert('筛选条件已清除');
        }
        
        function applyFilters() {
            alert('筛选条件已应用');
        }
        
        // 任务操作函数
        function editTask(taskId) {
            alert(`编辑任务 ${taskId} (功能开发中)`);
        }
        
        function viewTask(taskId) {
            window.location.href = `task-detail-admin.html?id=${taskId}`;
        }
        
        function deleteTask(taskId) {
            if (confirm('确定要删除这个任务吗？此操作不可撤销。')) {
                alert(`删除任务 ${taskId} (功能开发中)`);
            }
        }
        
        // 申请操作函数
        function viewApplication(appId) {
            alert(`查看申请 ${appId} (功能开发中)`);
        }
        
        function approveApplication(appId) {
            if (confirm('确定要通过这个申请吗？')) {
                alert(`通过申请 ${appId} (功能开发中)`);
            }
        }
        
        function rejectApplication(appId) {
            if (confirm('确定要拒绝这个申请吗？')) {
                alert(`拒绝申请 ${appId} (功能开发中)`);
            }
        }
        
        function undoApplication(appId) {
            if (confirm('确定要撤销这个申请的审核状态吗？')) {
                alert(`撤销申请 ${appId} (功能开发中)`);
            }
        }
        
        function logout() {
            if (confirm('确定要退出登录吗？')) {
                localStorage.removeItem('docim_user');
                window.location.href = 'index.html';
            }
        }
        
        // 弹窗函数
        function showErrorModal() {
            document.getElementById('initErrorModal').style.display = 'flex';
        }
        
        function closeErrorModal() {
            document.getElementById('initErrorModal').style.display = 'none';
        }
        
        function refreshPage() {
            window.location.reload();
        }
        
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            console.log('任务管理页面加载完成');
            
            // 初始化用户信息
            try {
                const userData = localStorage.getItem('docim_user');
                if (userData) {
                    const user = JSON.parse(userData);
                    const usernameElement = document.getElementById('username');
                    if (usernameElement) {
                        usernameElement.textContent = user.name + (user.role === 'admin' ? '老师' : '博士');
                    }
                }
            } catch (error) {
                console.error('加载用户信息失败:', error);
            }
            
            // 清除搜索按钮
            const clearSearchBtn = document.getElementById('clearSearch');
            const searchInput = document.getElementById('taskSearch');
            
            clearSearchBtn.addEventListener('click', function() {
                searchInput.value = '';
                searchInput.focus();
            });
            
            // 搜索框输入事件
            searchInput.addEventListener('input', function() {
                clearSearchBtn.style.display = this.value ? 'flex' : 'none';
            });
            
            // 初始化清除按钮状态
            clearSearchBtn.style.display = searchInput.value ? 'flex' : 'none';
            
            // 初始化通知系统
            if (!window.notificationSystem) {
                window.notificationSystem = new NotificationSystem();
                window.notificationSystem.init();
            }
            
            // 模拟页面初始化失败
            const shouldShowError = Math.random() < 0.05; // 5%几率显示错误
            if (shouldShowError) {
                setTimeout(() => {
                    showErrorModal();
                }, 1000);
            }
        });
    </script>
</body>
</html>